image:https://travis-ci.org/vmj/gradle-download-worker.svg?branch=master["Build Status", link="https://travis-ci.org/vmj/gradle-download-worker"]

# A parallel download task type for Gradle

This Gradle plugin implements a parallel download task type.

This is implemented with Gradle Worker API, so *Gradle 4.0 or newer* is required.
Also, *Java 8* is used.

## Usage

Basic usage is as follows:

```
  plugins {
    id 'fi.linuxbox.download.worker' version "0.3"
  }
  import fi.linuxbox.gradle.download.worker.DownloadWorkerTask

  task("my-download", type: DownloadWorkerTask) {
    from 'https://www.google.com/robots.txt'
    to "$buildDir/robots.txt"
  }
```

A more interesting example:

```
  plugins {
    id 'fi.linuxbox.download.worker' version "0.3"
  }
  import fi.linuxbox.gradle.download.worker.DownloadWorkerTask

  task downloadAll {
    group 'My tasks'
    description 'Download all ChangeLogs'
  }

  ext {
    distroNames = ['slackware', 'slackware64']
    distroVersions = ['13.0', '13.1', '13.37', '14.0', '14.1', '14.2']
  }

  distroNames.each { distroName ->
    distroVersions.each { distroVersion ->
      def distro = "$distroName-$distroVersion"
      def path = "$distroName/$distroVersion"

      // Define a parallel download task for this distro version
      def download = task("download-$distro-changelog", type: DownloadWorkerTask) {
        from "http://ftp.osuosl.org/pub/slackware/$distro/ChangeLog.txt"
        to new File(buildDir, "changelogs/$path/ChangeLog.txt")
      }

      // Just to demo the UP-TO-DATE functionality:
      // even though the download task does some work (conditional GET)
      // it doesn't necessarily touch the artifact.
      // That allows Gradle to skip the copy task.
      def copy = task("copy-$distro-changelog", type: Copy) {
        from download
        into new File(buildDir, "copies/$path/")
      }

      downloadAll.dependsOn copy
    }
  }
```

With above build script, the first run of `gradle downloadAll` would download
the ChangeLog files in parallel.  Then it would copy each ChangeLog as
soon as it was downloaded, i.e. in parallel.

The second invocation of `gradle downloadAll` would finish pretty quickly,
as the download task will make a conditional HTTP GET and,
since the ChangeLogs will not be updated,
copy tasks will report UP-TO-DATE.

## Task Configuration

In addition to the mandatory `from` (HTTP(S) URL) and `to` (anything that can be interpreted by project
`file` method, following optional properties can be set:

 * connectTimeout: Defaults to 30 seconds; specified in milliseconds
 * readTimeout: Defaults to 30 seconds; specified in milliseconds

